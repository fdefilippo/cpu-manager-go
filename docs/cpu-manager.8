.TH CPU\-MANAGER\-GO 8 "January 2026" "v1.0" "System Administration"
.SH NAME
cpu\-manager\-go \- Dynamic CPU manager for Linux using cgroups v2
.SH SYNOPSIS
.B cpu\-manager\-go
[\fB\-\-config\fR \fIFILE\fR]
[\fB\-\-version\fR]
.SH DESCRIPTION
.B cpu\-manager\-go
is a daemon that monitors system CPU usage and dynamically applies limits to users
when the load exceeds configured thresholds. It uses Linux cgroups v2 to manage
CPU resource distribution efficiently and proportionally.
.PP
The daemon operates in control cycles configured via
.B POLLING_INTERVAL
and makes decisions based on configurable thresholds to enable or disable CPU limits.
.SH OPTIONS
.TP
\fB\-\-config\fR \fIFILE\fR
Specifies the configuration file path. Default:
.I /etc/cpu\-manager.conf
.TP
\fB\-\-version\fR
Displays program version and exits.
.SH ARCHITECTURE AND CPU ALLOCATION
The system uses a cgroups v2 hierarchy to manage fair CPU resource distribution:
.IP 1. 3
Calculates available cores for users:
.I Total cores \- MIN_SYSTEM_CORES
.IP 2.
Creates a parent (shared) cgroup with the calculated total quota
.IP 3.
For each active user, creates a sub\-cgroup with equal
.B cpu.weight
.IP 4.
User processes are moved to their respective sub\-cgroups
.PP
Resource division occurs proportionally through cgroup
.B cpu.weight
values. If a user doesn't use CPU, other users can utilize more than their
fair share, up to the entire available quota.
.PP
Practical example with 4 total cores and MIN_SYSTEM_CORES=2:
.RS
.IP \(bu 2
Available cores for users: 2
.IP \(bu
2 active users \(-> each user gets weight 100
.IP \(bu
If User1 uses 0.5 cores, User2 can use 1.5 cores
.IP \(bu
If User1 uses no CPU, User2 can use all 2 cores
.RE
.SH CONTROL CYCLE
The daemon executes control cycles at regular intervals:
.IP 1. 3
Collects system metrics (total CPU usage, per\-user CPU, load average)
.IP 2.
Decision making based on configured thresholds
.IP 3.
Applying/removing limits via cgroups
.IP 4.
Logging and Prometheus metrics update (if enabled)
.SH CONFIGURATION FILE
The configuration file supports key=value format. Comments start with '#'.
.PP
Example
.I /etc/cpu\-manager.conf
format:
.nf
.sp
# =============================================
# CPU\-MANAGER\-GO CONFIGURATION
# =============================================

# PATHS
CGROUP_ROOT="/sys/fs/cgroup"
SCRIPT_CGROUP_BASE="cpu_manager"
CONFIG_FILE="/etc/cpu\-manager.conf"
LOG_FILE="/var/log/cpu\-manager.log"
CREATED_CGROUPS_FILE="/var/run/cpu\-manager\-cgroups.txt"
METRICS_CACHE_FILE="/var/run/cpu\-manager\-metrics.cache"
PROMETHEUS_FILE="/var/run/cpu\-manager\-metrics.prom"

# TIMING (seconds)
POLLING_INTERVAL=30          # Control cycle interval
MIN_ACTIVE_TIME=60           # Minimum activation time for limits
METRICS_CACHE_TTL=15         # Metrics cache duration

# CPU THRESHOLDS (percentage)
CPU_THRESHOLD=75             # Activation threshold
CPU_RELEASE_THRESHOLD=40     # Deactivation threshold

# CPU LIMITS ("quota period" format in microseconds)
CPU_QUOTA_NORMAL="max 100000"      # No limit (100000 = 100ms)
CPU_QUOTA_LIMITED="200000 100000"  # Limit: 2 core equivalents total

# PROMETHEUS EXPORTER
ENABLE_PROMETHEUS=false      # Enable metrics export
PROMETHEUS_PORT=9101         # Prometheus port
PROMETHEUS_HOST="127.0.0.1"  # Prometheus host

# PROMETHEUS TLS/HTTPS (optional)
PROMETHEUS_TLS_ENABLED=false            # Enable HTTPS/TLS
PROMETHEUS_TLS_CERT_FILE=/etc/cpu-manager/tls/server.crt    # Server certificate
PROMETHEUS_TLS_KEY_FILE=/etc/cpu-manager/tls/server.key     # Server private key
PROMETHEUS_TLS_CA_FILE=/etc/cpu-manager/tls/ca.crt          # CA certificate (optional)
PROMETHEUS_TLS_MIN_VERSION=1.2          # Minimum TLS version (1.0, 1.1, 1.2, 1.3)

# PROMETHEUS AUTHENTICATION (optional)
PROMETHEUS_AUTH_TYPE="none"          # Authentication: none, basic, jwt, both
PROMETHEUS_AUTH_USERNAME="prometheus" # Username for Basic Auth
PROMETHEUS_AUTH_PASSWORD_FILE="/etc/cpu-manager/prometheus_password"  # Password file path
PROMETHEUS_JWT_SECRET_FILE="/etc/cpu-manager/jwt_secret"  # JWT secret file path
PROMETHEUS_JWT_ISSUER="cpu-manager"   # JWT issuer claim
PROMETHEUS_JWT_AUDIENCE="prometheus"  # JWT audience claim
PROMETHEUS_JWT_EXPIRY=3600            # JWT token expiry in seconds

# LOGGING
LOG_LEVEL="INFO"             # DEBUG, INFO, WARN, ERROR
LOG_MAX_SIZE=10485760        # Maximum log file size (10MB)
USE_SYSLOG=true

# SYSTEM
MIN_SYSTEM_CORES=2           # Minimum cores reserved for system
SYSTEM_UID_MIN=1000          # Minimum UID for non\-system users
SYSTEM_UID_MAX=60000         # Maximum UID (default: pid_max)

# LOAD AVERAGE CHECKING
IGNORE_SYSTEM_LOAD=false     # If true, ignores load average in decisions
.sp
.fi
.SH ENVIRONMENT VARIABLES
All configuration options can be overridden by environment variables
with the same name. Example:
.sp
.nf
LOG_LEVEL=DEBUG cpu\-manager\-go \-\-config /etc/cpu\-manager.conf
.fi
.SH LOG FILES
.I /var/log/cpu\-manager.log
.br
The log file is automatically rotated when it reaches the maximum size
configured in
.B LOG_MAX_SIZE.
Rotation creates a backup file with .1 extension.
.SH STATE FILES
.I /var/run/cpu\-manager\-cgroups.txt
.br
Tracks created cgroups to enable cleanup after restart.
.SH PROMETHEUS METRICS
When enabled, the daemon exposes metrics at http://HOST:PORT/metrics
.IP \(bu 2
cpu_manager_cpu_total_usage_percent \- Total CPU usage
.IP \(bu
cpu_manager_cpu_user_usage_percent \- Non\-system user CPU usage
.IP \(bu
cpu_manager_memory_usage_megabytes \- Total system memory usage
.IP \(bu
cpu_manager_active_users_count \- Number of active non\-system users
.IP \(bu
cpu_manager_limited_users_count \- Users with active limits
.IP \(bu
cpu_manager_limits_active \- Limits status (1=active, 0=inactive)
.IP \(bu
cpu_manager_system_load_average \- System load average (1 minute)
.IP \(bu
cpu_manager_user_cpu_usage_percent{uid, username} \- CPU usage per user
.IP \(bu
cpu_manager_user_memory_usage_bytes{uid, username} \- Memory usage per user (bytes)
.IP \(bu
cpu_manager_user_process_count{uid, username} \- Number of processes per user
.IP \(bu
cpu_manager_user_cpu_limited{uid, username} \- User limit status (1=limited, 0=unlimited)
.IP \(bu
cpu_manager_limits_activated_total \- Total limit activations (counter)
.IP \(bu
cpu_manager_limits_deactivated_total \- Total limit deactivations (counter)
.IP \(bu
cpu_manager_control_cycle_duration_seconds \- Control cycle duration (histogram)
.IP \(bu
cpu_manager_errors_total{component, error_type} \- Errors by component (counter)
.PP
All user-specific metrics include
.B uid
and
.B username
labels for easy filtering and aggregation in Grafana dashboards.
.PP
Example queries:
.RS
.IP \(bu 2
Sum of all user memory:
.I sum(cpu_manager_user_memory_usage_bytes)
.IP \(bu
Top 5 users by CPU:
.I topk(5, cpu_manager_user_cpu_usage_percent)
.IP \(bu
Processes per user:
.I cpu_manager_user_process_count{username="francesco"}
.RE
.SH SIGNALS
.B SIGHUP
\- Reload configuration
.br
.B SIGINT, SIGTERM
\- Graceful shutdown
.SH EXAMPLES
Start with custom configuration:
.sp
.nf
cpu\-manager\-go \-\-config /etc/my\-config.conf
.fi
.sp
Start with debug logging:
.sp
.nf
LOG_LEVEL=DEBUG cpu\-manager\-go
.fi
.sp
Check version:
.sp
.nf
cpu\-manager\-go \-\-version
.fi
.SH SYSTEM REQUIREMENTS
.IP \(bu 2
Linux kernel 4.5+ (cgroups v2)
.IP \(bu
Write access to /sys/fs/cgroup
.IP \(bu
Root privileges or CAP_SYS_ADMIN capability
.IP \(bu
Go runtime (if running from source)
.SH EXIT STATUS
0 \- Success
.br
1 \- Configuration or runtime error
.SH FILES
.I /etc/cpu\-manager.conf
\- Configuration file
.br
.I /var/log/cpu\-manager.log
\- Log file
.br
.I /var/run/cpu\-manager\-*
\- State and cache files
.SH AUTHOR
Francesco Defilippo <francesco@defilippo.org>
.SH "SEE ALSO"
.BR cgroups (7),
.BR systemd.resource\-control (5),
.BR cpulimit (1)
.SH BUGS
Report bugs at: https://github.com/fdefilippo/cpu\-manager\-go/issues
.SH LICENSE
Distributed under MIT license.
